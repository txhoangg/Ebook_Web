<!DOCTYPE html>
<html lang="vi">
  <head>
    <base href="/" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản trị - EBook Haven</title>
    <link rel="stylesheet" href="/assets/css/normalize.css" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link rel="stylesheet" href="/assets/css/responsive.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #4361ee;
        --primary-dark: #3a56d4;
        --secondary: #2ec4b6;
        --secondary-dark: #21a99d;
        --dark: #2b2d42;
        --dark-light: #3d405b;
        --light: #f8f9fa;
        --light-gray: #e9ecef;
        --gray: #6c757d;
        --danger: #ef476f;
        --warning: #ffd166;
        --success: #06d6a0;
        --accent: #ff9f1c;
      }

      body {
        background-color: #f0f4f8;
      }

      .admin-container {
        display: flex;
        min-height: calc(100vh - 70px);
      }

      .admin-sidebar {
        width: 260px;
        background: linear-gradient(to bottom, #2c3e50, #1a252f);
        color: white;
        padding: 0;
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 100;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .admin-sidebar-header {
        padding: 25px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .admin-sidebar-header h2 {
        margin: 0;
        font-size: 1.5rem;
        letter-spacing: 1px;
        font-weight: 600;
        color: white;
      }

      .admin-sidebar-header h2 i {
        margin-right: 10px;
        color: var(--primary);
      }

      .admin-menu {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .admin-menu-item {
        margin-bottom: 5px;
      }

      .admin-menu-item a {
        padding: 14px 20px;
        display: flex;
        align-items: center;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s;
        position: relative;
        font-weight: 500;
        border-left: 3px solid transparent;
      }

      .admin-menu-item a i {
        width: 24px;
        margin-right: 10px;
        font-size: 1.1rem;
        text-align: center;
      }

      .admin-menu-item a:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .admin-menu-item.active a {
        background-color: rgba(67, 97, 238, 0.15);
        color: var(--primary);
        border-left: 3px solid var(--primary);
      }

      .admin-content {
        flex: 1;
        padding: 30px;
        margin-left: 260px;
        transition: all 0.3s ease;
      }

      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.04);
      }

      .admin-header h1 {
        margin: 0;
        font-size: 1.8rem;
        color: var(--dark);
        font-weight: 600;
      }

      .admin-date {
        font-size: 1rem;
        padding: 8px 15px;
        background: var(--light);
        border-radius: 30px;
        color: var(--gray);
        display: flex;
        align-items: center;
      }

      .admin-date i {
        margin-right: 8px;
        color: var(--primary);
      }

      .admin-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .admin-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.04);
        transition: all 0.3s ease;
        overflow: hidden;
        position: relative;
        border-bottom: 3px solid transparent;
      }

      .admin-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-bottom: 3px solid var(--primary);
      }

      .admin-card-title {
        color: var(--gray);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 15px;
        font-weight: 600;
      }

      .admin-card-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--dark);
      }

      .admin-card-change {
        display: flex;
        align-items: center;
        font-size: 0.9rem;
        padding: 5px 12px;
        border-radius: 30px;
        display: inline-flex;
      }

      .admin-card-change i {
        margin-right: 5px;
      }

      .admin-card-change.positive {
        background-color: rgba(6, 214, 160, 0.1);
        color: var(--success);
      }

      .admin-card-change.negative {
        background-color: rgba(239, 71, 111, 0.1);
        color: var(--danger);
      }

      .admin-tables {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .admin-table {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.04);
        overflow: hidden;
      }

      .admin-table-header {
        padding: 20px 25px;
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .admin-table-header h3 {
        margin: 0;
        font-size: 1.2rem;
        color: var(--dark);
        font-weight: 600;
      }

      .admin-table-header a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s;
        display: flex;
        align-items: center;
      }

      .admin-table-header a i {
        margin-left: 5px;
      }

      .admin-table-header a:hover {
        color: var(--primary-dark);
      }

      .admin-table-content {
        padding: 0;
      }

      .admin-table table {
        width: 100%;
        border-collapse: collapse;
      }

      .admin-table th,
      .admin-table td {
        padding: 15px 25px;
        text-align: left;
        border-bottom: 1px solid var(--light-gray);
      }

      .admin-table th {
        font-weight: 600;
        color: var(--gray);
        background-color: rgba(248, 249, 250, 0.5);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .admin-table tbody tr {
        transition: all 0.3s;
      }

      .admin-table tbody tr:last-child td {
        border-bottom: none;
      }

      .admin-table tbody tr:hover {
        background-color: rgba(67, 97, 238, 0.03);
      }

      .status {
        padding: 5px 12px;
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
      }

      .status.active {
        background-color: rgba(6, 214, 160, 0.1);
        color: var(--success);
      }

      .status.inactive {
        background-color: rgba(108, 117, 125, 0.1);
        color: var(--gray);
      }

      .status.pending {
        background-color: rgba(255, 209, 102, 0.1);
        color: var(--warning);
      }

      .error-message {
        background-color: rgba(239, 71, 111, 0.1);
        color: var(--danger);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        display: none;
        align-items: center;
        font-weight: 500;
        box-shadow: 0 2px 10px rgba(239, 71, 111, 0.1);
      }

      .error-message i {
        margin-right: 10px;
        font-size: 1.2rem;
      }

      .error-message.show {
        display: flex;
      }

      #debug-info {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: rgba(27, 38, 59, 0.95);
        color: white;
        padding: 15px;
        border-radius: 8px;
        max-width: 400px;
        max-height: 300px;
        overflow: auto;
        z-index: 9999;
        font-size: 13px;
        font-family: "Consolas", monospace;
        display: none;
        backdrop-filter: blur(10px);
      }

      .debug-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: var(--dark);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        z-index: 10000;
        font-weight: 500;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .debug-toggle:hover {
        background-color: #1a202c;
      }

      .animate-item {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease, transform 0.5s ease;
      }

      .animate-item.show {
        opacity: 1;
        transform: translateY(0);
      }

      @media (max-width: 1200px) {
        .admin-tables {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 992px) {
        .admin-sidebar {
          width: 80px;
        }

        .admin-sidebar-header {
          padding: 20px 10px;
        }

        .admin-sidebar-header h2 {
          display: none;
        }

        .admin-menu-item a {
          padding: 15px;
          justify-content: center;
        }

        .admin-menu-item a i {
          margin-right: 0;
          font-size: 1.3rem;
        }

        .admin-menu-item a span {
          display: none;
        }

        .admin-content {
          margin-left: 80px;
        }
      }

      @media (max-width: 768px) {
        .admin-container {
          flex-direction: column;
        }

        .admin-sidebar {
          width: 100%;
          height: auto;
          position: relative;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-sidebar-header {
          padding: 15px;
        }

        .admin-sidebar-header h2 {
          display: block;
          font-size: 1.3rem;
        }

        .admin-menu {
          display: flex;
          flex-wrap: wrap;
        }

        .admin-menu-item {
          flex: 1;
          margin-bottom: 0;
        }

        .admin-menu-item a {
          padding: 12px 10px;
          flex-direction: column;
          font-size: 0.8rem;
          text-align: center;
        }

        .admin-menu-item a i {
          margin: 0 0 5px 0;
        }

        .admin-menu-item a span {
          display: block;
        }

        .admin-content {
          margin-left: 0;
          padding: 20px;
        }

        .admin-cards {
          grid-template-columns: 1fr;
        }

        .admin-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }
      }
    </style>
  </head>
  <body>
    <header style="display: none">
      <div class="container header-container">
        <a href="/index.html" class="logo">Ebook<span>Haven</span></a>
        <div class="search-bar">
          <input
            type="text"
            id="search-input"
            placeholder="Tìm kiếm sách, tác giả..."
          />
          <button><i class="fas fa-search"></i></button>
        </div>
        <div class="mobile-menu-toggle" id="mobile-menu-toggle">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <ul class="nav-menu" id="nav-menu">
          <li>
            <a href="/index.html"><i class="fas fa-home"></i> Trang chủ</a>
          </li>
          <li>
            <a href="/categories.html"><i class="fas fa-tags"></i> Danh mục</a>
          </li>
          <li>
            <a href="/upload-book.html"
              ><i class="fas fa-upload"></i> Tải lên sách</a
            >
          </li>
          <li>
            <a href="#" id="login-btn"
              ><i class="fas fa-sign-in-alt"></i> Đăng nhập</a
            >
          </li>
          <li>
            <a href="#" id="register-btn"
              ><i class="fas fa-user-plus"></i> Đăng ký</a
            >
          </li>
        </ul>
      </div>
    </header>

    <div class="error-message" id="error-container">
      <i class="fas fa-exclamation-circle"></i>
      <span id="error-message">Đã xảy ra lỗi</span>
    </div>

    <div class="admin-container">
      <div class="admin-sidebar">
        <div class="admin-sidebar-header">
          <h2><i class="fas fa-cogs"></i> Admin Panel</h2>
        </div>
        <ul class="admin-menu">
          <li class="admin-menu-item active">
            <a href="/admin-dashboard.html">
              <i class="fas fa-chart-line"></i>
              <span>Tổng quan</span>
            </a>
          </li>
          <li class="admin-menu-item">
            <a href="/admin-books.html">
              <i class="fas fa-book"></i>
              <span>Quản lý sách</span>
            </a>
          </li>
          <li class="admin-menu-item">
            <a href="/admin-users.html">
              <i class="fas fa-users"></i>
              <span>Quản lý người dùng</span>
            </a>
          </li>
          <li class="admin-menu-item">
            <a href="/admin-categories.html">
              <i class="fas fa-tags"></i>
              <span>Quản lý danh mục</span>
            </a>
          </li>
          <li class="admin-menu-item">
            <a href="/index.html">
              <i class="fas fa-home"></i>
              <span>Trang chủ</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="admin-content">
        <div class="admin-header animate-item">
          <h1>Tổng quan hệ thống</h1>
          <div class="admin-date">
            <i class="far fa-calendar-alt"></i>
            <span id="current-date">Đang tải...</span>
          </div>
        </div>

        <div class="admin-cards">
          <div class="admin-card animate-item">
            <div class="admin-card-title">Tổng số sách</div>
            <div class="admin-card-value" id="total-books">
              <i class="fas fa-spinner fa-spin"></i>
            </div>
            <div class="admin-card-change positive" id="books-change">
              <i class="fas fa-arrow-up"></i> +5% so với tháng trước
            </div>
          </div>

          <div class="admin-card animate-item">
            <div class="admin-card-title">Tổng người dùng</div>
            <div class="admin-card-value" id="total-users">
              <i class="fas fa-spinner fa-spin"></i>
            </div>
            <div class="admin-card-change positive" id="users-change">
              <i class="fas fa-arrow-up"></i> +12% so với tháng trước
            </div>
          </div>

          <div class="admin-card animate-item">
            <div class="admin-card-title">Lượt tải xuống</div>
            <div class="admin-card-value" id="total-downloads">
              <i class="fas fa-spinner fa-spin"></i>
            </div>
            <div class="admin-card-change positive" id="downloads-change">
              <i class="fas fa-arrow-up"></i> +8% so với tháng trước
            </div>
          </div>

          <div class="admin-card animate-item">
            <div class="admin-card-title">Đánh giá trung bình</div>
            <div class="admin-card-value" id="avg-rating">
              <i class="fas fa-spinner fa-spin"></i>
            </div>
            <div class="admin-card-change positive" id="rating-change">
              <i class="fas fa-arrow-up"></i> +0.2 so với tháng trước
            </div>
          </div>
        </div>

        <div class="admin-tables">
          <div class="admin-table animate-item">
            <div class="admin-table-header">
              <h3>Sách mới nhất</h3>
              <a href="/admin-books.html"
                >Xem tất cả <i class="fas fa-arrow-right"></i
              ></a>
            </div>
            <div class="admin-table-content">
              <table>
                <thead>
                  <tr>
                    <th>Tiêu đề</th>
                    <th>Tác giả</th>
                    <th>Ngày đăng</th>
                    <th>Trạng thái</th>
                  </tr>
                </thead>
                <tbody id="latest-books-table">
                  <tr>
                    <td colspan="4" style="text-align: center">
                      <i class="fas fa-spinner fa-spin"></i> Đang tải...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="admin-table animate-item">
            <div class="admin-table-header">
              <h3>Người dùng mới nhất</h3>
              <a href="/admin-users.html"
                >Xem tất cả <i class="fas fa-arrow-right"></i
              ></a>
            </div>
            <div class="admin-table-content">
              <table>
                <thead>
                  <tr>
                    <th>Tên người dùng</th>
                    <th>Email</th>
                    <th>Ngày đăng ký</th>
                    <th>Vai trò</th>
                  </tr>
                </thead>
                <tbody id="latest-users-table">
                  <tr>
                    <td colspan="4" style="text-align: center">
                      <i class="fas fa-spinner fa-spin"></i> Đang tải...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button class="debug-toggle" id="debug-toggle">
      <i class="fas fa-bug"></i> Debug
    </button>
    <div id="debug-info"></div>

    <footer style="display: none">
      <div class="container footer-container">
        <div class="footer-col">
          <h3>Ebook Haven</h3>
          <p>
            Thư viện sách điện tử cho mọi người yêu thích đọc sách và học hỏi.
          </p>

          <div class="social-icons">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
        <div class="footer-col">
          <h3>Khám phá</h3>
          <ul>
            <li><a href="categories.html">Danh mục</a></li>
            <li><a href="upload-book.html">Tải lên sách</a></li>
            <li><a href="profile.html">Trang cá nhân</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>Liên kết</h3>
          <ul>
            <li><a href="#">Giới thiệu</a></li>
            <li><a href="#">Điều khoản sử dụng</a></li>
            <li><a href="#">Chính sách bảo mật</a></li>
            <li><a href="#">Liên hệ</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>Hỗ trợ</h3>
          <ul>
            <li><a href="#">Câu hỏi thường gặp</a></li>
            <li><a href="#">Hướng dẫn sử dụng</a></li>
            <li><a href="#">Báo cáo lỗi</a></li>
          </ul>
        </div>
      </div>
      <div class="container">
        <div class="copyright">
          &copy; 2025 Ebook Haven. Tất cả quyền được bảo lưu.
        </div>
      </div>
    </footer>

    <script src="/assets/js/api.service.js"></script>
    <script src="/assets/js/helper.js"></script>
    <script src="/assets/js/main.js"></script>
    <script>
      function initAnimations() {
        const animateItems = document.querySelectorAll(".animate-item");

        if (animateItems.length > 0) {
          animateItems.forEach((item, index) => {
            setTimeout(() => {
              item.classList.add("show");
            }, 100 * index);
          });
        }
      }

      window.debugLog = function (message) {
        const debugDiv = document.getElementById("debug-info");
        if (debugDiv) {
          const time = new Date().toLocaleTimeString();
          debugDiv.innerHTML += `<div>[${time}] ${message}</div>`;
          debugDiv.scrollTop = debugDiv.scrollHeight;
        }
      };

      document
        .getElementById("debug-toggle")
        .addEventListener("click", function () {
          const debugInfo = document.getElementById("debug-info");
          if (debugInfo.style.display === "none" || !debugInfo.style.display) {
            debugInfo.style.display = "block";
          } else {
            debugInfo.style.display = "none";
          }
        });

      function showError(message) {
        const errorContainer = document.getElementById("error-container");
        const errorMessage = document.getElementById("error-message");

        errorMessage.textContent = message;
        errorContainer.classList.add("show");

        debugLog(`ERROR: ${message}`);
      }

      function checkToken() {
        const user = apiService.auth.getCurrentUser();
        if (!user || !user.accessToken) {
          return false;
        }

        return true;
      }

      document.addEventListener("DOMContentLoaded", async function () {
        initAnimations();
        debugLog("Trang đã được tải, bắt đầu khởi tạo...");

        if (!apiService.auth.isAuthenticated()) {
          debugLog("Người dùng chưa đăng nhập");
          showError("Bạn cần đăng nhập để truy cập trang quản trị!");
          setTimeout(() => {
            window.location.href = "/index.html";
          }, 2000);
          return;
        }

        const user = apiService.auth.getCurrentUser();
        debugLog(`Người dùng: ${user.username}, Vai trò: ${user.role}`);

        if (user.role !== "admin") {
          debugLog("Người dùng không có quyền admin");
          showError("Bạn không có quyền truy cập trang quản trị!");
          setTimeout(() => {
            window.location.href = "/index.html";
          }, 2000);
          return;
        }

        if (!checkToken()) {
          debugLog("Token không hợp lệ hoặc đã hết hạn");
          showError("Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại!");
          setTimeout(() => {
            apiService.auth.logout();
            window.location.href = "/index.html";
          }, 2000);
          return;
        }

        const now = new Date();
        document.getElementById("current-date").textContent =
          now.toLocaleDateString("vi-VN", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

        debugLog("Ngày hiện tại đã được cập nhật");

        try {
          debugLog("Bắt đầu tải dữ liệu thống kê...");

          const statsPromise = Promise.race([
            apiService.admin.getStats(),
            new Promise((_, reject) =>
              setTimeout(
                () => reject(new Error("Thời gian yêu cầu quá lâu")),
                10000
              )
            ),
          ]);

          const stats = await statsPromise;
          debugLog("Đã nhận được dữ liệu thống kê");

          document.getElementById("total-books").textContent =
            stats.totalBooks || 0;
          document.getElementById("total-users").textContent =
            stats.totalUsers || 0;
          document.getElementById("total-downloads").textContent =
            stats.totalDownloads || 0;
          document.getElementById("avg-rating").textContent = parseFloat(
            stats.avgRating || 0
          ).toFixed(1);

          document.getElementById("books-change").innerHTML = `
            <i class="fas ${
              stats.booksGrowth >= 0 ? "fa-arrow-up" : "fa-arrow-down"
            }"></i>
            ${stats.booksGrowth >= 0 ? "+" : ""}${
            stats.booksGrowth || 0
          }% so với tháng trước
          `;
          document.getElementById("users-change").innerHTML = `
            <i class="fas ${
              stats.usersGrowth >= 0 ? "fa-arrow-up" : "fa-arrow-down"
            }"></i>
            ${stats.usersGrowth >= 0 ? "+" : ""}${
            stats.usersGrowth || 0
          }% so với tháng trước
          `;
          document.getElementById("downloads-change").innerHTML = `
            <i class="fas ${
              stats.downloadsGrowth >= 0 ? "fa-arrow-up" : "fa-arrow-down"
            }"></i>
            ${stats.downloadsGrowth >= 0 ? "+" : ""}${
            stats.downloadsGrowth || 0
          }% so với tháng trước
          `;
          document.getElementById("rating-change").innerHTML = `
            <i class="fas ${
              stats.ratingChange >= 0 ? "fa-arrow-up" : "fa-arrow-down"
            }"></i>
            ${stats.ratingChange >= 0 ? "+" : ""}${
            stats.ratingChange || 0
          } so với tháng trước
          `;

          if (stats.booksGrowth < 0) {
            document
              .getElementById("books-change")
              .classList.remove("positive");
            document.getElementById("books-change").classList.add("negative");
          }

          if (stats.usersGrowth < 0) {
            document
              .getElementById("users-change")
              .classList.remove("positive");
            document.getElementById("users-change").classList.add("negative");
          }

          if (stats.downloadsGrowth < 0) {
            document
              .getElementById("downloads-change")
              .classList.remove("positive");
            document
              .getElementById("downloads-change")
              .classList.add("negative");
          }

          if (stats.ratingChange < 0) {
            document
              .getElementById("rating-change")
              .classList.remove("positive");
            document.getElementById("rating-change").classList.add("negative");
          }

          debugLog("Bắt đầu tải danh sách sách mới nhất...");
          const latestBooks = await apiService.admin.getLatestBooks();
          debugLog(`Đã nhận được ${latestBooks.length} sách mới nhất`);
          renderLatestBooks(latestBooks);

          debugLog("Bắt đầu tải danh sách người dùng mới nhất...");
          const latestUsers = await apiService.admin.getLatestUsers();
          debugLog(`Đã nhận được ${latestUsers.length} người dùng mới nhất`);
          renderLatestUsers(latestUsers);

          debugLog("Tất cả dữ liệu đã được tải thành công!");
        } catch (error) {
          console.error("Error loading admin dashboard:", error);
          debugLog(`Lỗi: ${error.message}`);

          if (error.message.includes("Authentication")) {
            showError("Xác thực thất bại. Vui lòng đăng nhập lại!");
            setTimeout(() => {
              apiService.auth.logout();
              window.location.href = "/index.html";
            }, 2000);
          } else if (
            error.message.includes("timeout") ||
            error.message.includes("quá lâu")
          ) {
            showError(
              "Không thể kết nối đến máy chủ. Vui lòng kiểm tra kết nối mạng và thử lại sau!"
            );
          } else {
            showError("Lỗi khi tải dữ liệu! " + error.message);
          }

          renderEmptyData();
        }
      });

      function renderEmptyData() {
        document.getElementById("total-books").textContent = "0";
        document.getElementById("total-users").textContent = "0";
        document.getElementById("total-downloads").textContent = "0";
        document.getElementById("avg-rating").textContent = "0.0";

        document.getElementById(
          "books-change"
        ).innerHTML = `<i class="fas fa-minus"></i> 0% so với tháng trước`;
        document.getElementById(
          "users-change"
        ).innerHTML = `<i class="fas fa-minus"></i> 0% so với tháng trước`;
        document.getElementById(
          "downloads-change"
        ).innerHTML = `<i class="fas fa-minus"></i> 0% so với tháng trước`;
        document.getElementById(
          "rating-change"
        ).innerHTML = `<i class="fas fa-minus"></i> 0 so với tháng trước`;

        document.getElementById(
          "latest-books-table"
        ).innerHTML = `<tr><td colspan="4" style="text-align: center;">Không có dữ liệu</td></tr>`;
        document.getElementById(
          "latest-users-table"
        ).innerHTML = `<tr><td colspan="4" style="text-align: center;">Không có dữ liệu</td></tr>`;
      }

      function renderLatestBooks(books) {
        debugLog("Đang render danh sách sách mới nhất");
        const tableBody = document.getElementById("latest-books-table");

        if (!books || books.length === 0) {
          tableBody.innerHTML =
            '<tr><td colspan="4" style="text-align: center;">Không có dữ liệu</td></tr>';
          return;
        }

        tableBody.innerHTML = "";

        books.forEach((book) => {
          const row = document.createElement("tr");

          const dateCreated = new Date(book.createdAt).toLocaleDateString();

          row.innerHTML = `
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 32px; height: 32px; overflow: hidden; border-radius: 4px; background-color: #f0f0f0;">
                  <img src="${
                    book.coverPath || "/api/placeholder/32/32"
                  }" alt="${
            book.title
          }" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src='/api/placeholder/32/32';">
                </div>
                <span style="font-weight: 500;">${book.title}</span>
              </div>
            </td>
            <td>${book.author}</td>
            <td>${dateCreated}</td>
            <td><span class="status ${
              book.status ? book.status.toLowerCase() : "pending"
            }">${book.status || "Chờ duyệt"}</span></td>
          `;

          tableBody.appendChild(row);
        });
      }

      function renderLatestUsers(users) {
        debugLog("Đang render danh sách người dùng mới nhất");
        const tableBody = document.getElementById("latest-users-table");

        if (!users || users.length === 0) {
          tableBody.innerHTML =
            '<tr><td colspan="4" style="text-align: center;">Không có dữ liệu</td></tr>';
          return;
        }

        tableBody.innerHTML = "";

        users.forEach((user) => {
          const row = document.createElement("tr");

          const dateCreated = new Date(user.createdAt).toLocaleDateString();
          const roleBadge = getRoleBadge(user.role);

          row.innerHTML = `
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                  ${user.username.charAt(0).toUpperCase()}
                </div>
                <span style="font-weight: 500;">${user.username}</span>
              </div>
            </td>
            <td>${user.email}</td>
            <td>${dateCreated}</td>
            <td>${roleBadge}</td>
          `;

          tableBody.appendChild(row);
        });
      }

      function getRoleBadge(role) {
        switch (role) {
          case "admin":
            return '<span class="status active" style="background-color: rgba(67, 97, 238, 0.1); color: var(--primary);">Admin</span>';
          case "moderator":
            return '<span class="status active" style="background-color: rgba(46, 196, 182, 0.1); color: var(--secondary);">Moderator</span>';
          default:
            return '<span class="status active" style="background-color: rgba(108, 117, 125, 0.1); color: var(--gray);">User</span>';
        }
      }
    </script>
    <div id="notification-container"></div>
  </body>
</html>
